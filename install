#!/usr/bin/env bash

# Check for GNU Stow
if ! command -v stow &> /dev/null
then
    echo "GNU Stow could not be found, please install it first."
    exit
fi

mkdir -p $HOME/.config

### Stow finished
# ZSH
echo COPYING .zshrc
rm -rf $HOME/.zshrc
rm -rf $HOME/.config/zsh
stow --target=$HOME zsh

# TMux
echo COPYING tmux.conf
rm -rf $HOME/.config/tmux
stow --target=$HOME tmux

# Neovim
echo COPYING .config/nvim
rm -rf $HOME/.config/nvim
stow --target=$HOME nvim

# Starship
echo COPYING .config/starship.toml
rm -rf $HOME/.config/starship.toml
stow --target=$HOME starship

# echo COPYING .gitconfig
rm -rf $HOME/.gitconfig
rm -rf $HOME/.config/git
stow --target=$HOME git
git config --global core.excludesFile $HOME/.config/git/.gitignore_global
# configuring diff-so-fancy to be used by git
git config --global core.pager "diff-so-fancy | less --tabs=4 -RF"
git config --global interactive.diffFilter "diff-so-fancy --patch"

# Ghostty Terminal Emulator
echo COPYING .config/ghostty/config
rm -rf $HOME/.config/ghostty
stow --target=$HOME ghostty

# Mise
echo COPYING .config/mise
rm -rf $HOME/.config/mise
stow --target=$HOME mise

# Newsboat RSS Reader
echo COPYING .newsboat/urls .newsboat/config .newsboat/dark
rm -rf $HOME/.newsboat
stow --target=$HOME newsboat

# Zed Editor Settings
echo COPYING .config/zed/
rm -rf $HOME/.config/zed
stow --target=$HOME zed

### To Stow

# NPM configuration for global packages
echo COPYING .npmrc
rm -rf $HOME/.npmrc
ln -s $DOTFILES/npm/npmrc $HOME/.npmrc

# Wezterm Terminal Emulator
echo COPYING .wezterm.lua
rm -rf $HOME/.wezterm.lua
ln -s $DOTFILES/wezterm/wezterm.lua $HOME/.wezterm.lua

# Alactritty Terminal Emulator
echo COPYING .config/alacritty/alacritty.toml
rm -rf $HOME/.config/alacritty/
mkdir -p $HOME/.config/alacritty
ln -s $DOTFILES/alacritty/alacritty.toml $HOME/.config/alacritty/alacritt.toml

# echo COPYING .ocamlinit
rm -rf $HOME/.ocamlinit
ln -s $DOTFILES/ocaml/ocamlinit $HOME/.ocamlinit

echo COPYING scripts
mkdir -p $HOME/.local/bin
rm -rf $HOME/.local/bin/t
# ln -s $DOTFILES/scripts/t $HOME/.local/bin/t

# echo INSTALLING ZSHRC
if [ !-d "$HOME/.oh-my-zsh" ]; then
    KEEP_ZSHRC=yes sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
fi

echo COPYING ideavim config
rm -rf $HOME/.ideavimrc
ln -s $DOTFILES/jetbrains/.ideavimrc $HOME/.ideavimrc

# installing fzf-tab
mkdir -p $HOME/.config/
git clone https://github.com/Aloxaf/fzf-tab $HOME/.config/

source ~/.zshrc
$DOTFILES/asdf/install
