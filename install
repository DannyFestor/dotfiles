#!/usr/bin/env bash

# Check for GNU Stow
if ! command -v stow &> /dev/null
then
    echo "GNU Stow could not be found, please install it first."
    exit
fi

mkdir -p $HOME/.config

### Stow finished
# ZSH
echo COPYING .zshrc
rm -rf $HOME/.zshrc
rm -rf $HOME/.config/zsh
stow --target=$HOME zsh

# TMux
echo COPYING tmux.conf
rm -rf $HOME/.config/tmux
stow --target=$HOME tmux

# Neovim
echo COPYING .config/nvim
rm -rf $HOME/.config/nvim
stow --target=$HOME nvim

# Starship
echo COPYING .config/starship.toml
rm -rf $HOME/.config/starship.toml
stow --target=$HOME starship

# echo COPYING .gitconfig
rm -rf $HOME/.gitconfig
rm -rf $HOME/.config/git
stow --target=$HOME git
git config --global core.excludesFile $HOME/.config/git/.gitignore_global

# Ghostty Terminal Emulator
echo COPYING .config/ghostty/config
rm -rf $HOME/.config/ghostty
stow --target=$HOME ghostty

### To Stow

# ASDF
git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.11.3

echo COPYING .config/zed/settings.json
mkdir -p $HOME/.config/zed
rm -rf $HOME/.config/zed/settings.json
ln -s $HOME/git/dotfiles/zed/settings.json $HOME/.config/zed/settings.json

echo COPYING .config/phpactor
rm -rf $HOME/.config/phpactor
ln -s $DOTFILES/phpactor $HOME/.config/phpactor

# echo COPYING .config/phpmon
mkdir -p $HOME/.config/phpmon
rm -rf $HOME/.config/phpmon/config.json
ln -s $DOTFILES/phpmon/config.json $HOME/.config/phpmon/config.json

# NPM configuration for global packages
echo COPYING .npmrc
rm -rf $HOME/.npmrc
ln -s $DOTFILES/npm/npmrc $HOME/.npmrc

# Wezterm Terminal Emulator
echo COPYING .wezterm.lua
rm -rf $HOME/.wezterm.lua
ln -s $DOTFILES/wezterm/wezterm.lua $HOME/.wezterm.lua

# Alactritty Terminal Emulator
echo COPYING .config/alacritty/alacritty.toml
rm -rf $HOME/.config/alacritty/
mkdir -p $HOME/.config/alacritty
ln -s $DOTFILES/alacritty/alacritty.toml $HOME/.config/alacritty/alacritt.toml

# echo COPYING .config/raycast
# rm -rf $HOME/.config/raycast
# ln -s $DOTFILES/raycast $HOME/.config/raycast
#
# echo COPYING .ocamlinit
rm -rf $HOME/.ocamlinit
ln -s $DOTFILES/ocaml/ocamlinit $HOME/.ocamlinit

# Newsboat RSS Reader
echo COPYING .newsboat/urls .newsboat/config .newsboat/dark
rm -rf $HOME/.newsboat/urls
rm -rf $HOME/.newsboat/config
rm -rf $HOME/.newsboat/dark
mkdir -p $HOME/.newsboat
ln -s $DOTFILES/newsboat/urls $HOME/.newsboat/urls
ln -s $DOTFILES/newsboat/config $HOME/.newsboat/config
ln -s $DOTFILES/newsboat/dark $HOME/.newsboat/dark

# echo COPYING .config/yabai/yabairc Tiling Window Manager
# brew install koekeishiya/formulae/yabai
# yabai --start-service
rm -rf $HOME/.config/yabai/yabairc
mkdir -p $HOME/.config/yabai
ln -s $DOTFILES/yabai/yabairc $HOME/.config/yabai/yabairc

# echo COPYING .config/skhd/skhdrc Keyboard Shortcut Manager
#  brew install koekeishiya/formulae/skhd
#  skhd --start-service
rm -rf $HOME/.config/skhd/skhdrc
mkdir -p $HOME/.config/skhd
ln -s $DOTFILES/skhd/skhdrc $HOME/.config/skhd/skhdrc

echo COPYING scripts
mkdir -p $HOME/.local/bin
rm -rf $HOME/.local/bin/t
# ln -s $DOTFILES/scripts/t $HOME/.local/bin/t

# echo INSTALLING ZSHRC
if [ !-d "$HOME/.oh-my-zsh" ]; then
    KEEP_ZSHRC=yes sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
fi

echo COPYING ideavim config
rm -rf $HOME/.ideavimrc
ln -s $DOTFILES/jetbrains/.ideavimrc $HOME/.ideavimrc

# installing fzf-tab
mkdir -p $HOME/.config/
git clone https://github.com/Aloxaf/fzf-tab $HOME/.config/

# configuring diff-so-fancy to be used by git
git config --global core.pager "diff-so-fancy | less --tabs=4 -RF"
git config --global interactive.diffFilter "diff-so-fancy --patch"

source ~/.zshrc
$DOTFILES/asdf/install
